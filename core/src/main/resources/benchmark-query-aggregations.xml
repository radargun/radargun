<benchmark xmlns="urn:radargun:benchmark:2.2">

   <master bindAddress="${master.address:127.0.0.1}" port="${master.port:2103}" />

   <clusters>
      <scale from="1" to="2">
         <cluster/>
      </scale>
   </clusters>

   <configurations>
      <config name="Infinispan80">
         <setup plugin="infinispan80">
            <default xmlns="urn:radargun:plugins:infinispan80:2.2" file="query-aggregations.xml" cache="dist_indexless"/>
         </setup>
      </config>
   </configurations>

   <scenario>
      <service-start />

      <!-- Loading the data -->
      <load-data seed="1" num-entries="5000"
                 num-threads="10" entry-size="0"
                 transaction-size="${tx.size:500}" use-transactions="${tx.type:NEVER}" max-load-attempts="50">
         <value-generator>
            <number-object int-min="0" int-max="10000" double-min="0" double-max="20"/>
         </value-generator>
      </load-data>

      <!-- SELECT sum(integerValue) FROM NumberObject WHERE integerValue<50000 AND doubleValue<2
           GROUP BY doubleValue HAVING sum(integerValue)>50000 ORDER BY sum(integerValue) -->
      <query test-name="globalSum"
             duration="30s"
             group-by="doubleValue"
             num-threads-per-node="10"
             query-object-class="org.radargun.query.NumberObject">
         <projection-aggregated>
            <sum path="integerValue"/>
         </projection-aggregated>
         <conditions>
            <lt path="integerValue" value="50000"/>
            <lt path="doubleValue" value="10"/>
         </conditions>
         <having>
            <gt value="50000">
               <aggregated-path>
                  <sum path="integerValue"/>
               </aggregated-path>
            </gt>
         </having>
         <order-by-aggregated-columns>
            <sum path="integerValue"/>
         </order-by-aggregated-columns>
      </query>
   </scenario>

   <reports>
      <reporter type="html"/>
      <reporter type="csv"/>
   </reports>

</benchmark>